# Чек-лист — CRM → Сайт → Статьи / Редактирование (SMOKE)

**Project:** CRM  
**Компонент/Модуль:** Сайт → Блог  
**Раздел:** Статьи  
**Подраздел:** Редактирование  
**Экран/URL/Маршрут:** https://crm-test.anflat.ru/management/site-developer-admin/blog-articles/list  
**Тестер:** Юлия  
**Дата:** 24.09.2025  
**Окружение:** test  
**Сборка/Версия:** v.400b6cfa  
**Роль:** admin  
**ОС/Браузер/Разрешение:** Windows 11 / Chrome (последняя) / 1920×1080  

### Предусловия
- Есть существующая статья, доступна форма «Редактировать».
- Права доступа уровня admin.

---

## 1. Доступ и форма
- [x] Открыть «Редактировать» из списка → форма загружается; видны поля: Заголовок, Ссылка (slug), Превью, Главное изображение (1 файл), Контент (блоки), SEO, «Публикация на сайте».

## 2. Контент-блоки (`contentBlocks`)
- [x] Исправить текст в существующем блоке → после «Сохранить» правка видна после перезагрузки и на сайте.
- [x] Перетащить любой блок вверх/вниз → порядок сохраняется.
- [x] Удалить блок → после перезагрузки блок отсутствует.
- [ ] Добавить «Изображение», загрузить файл → картинка видна в редакторе и на сайте; в Network payload URL публичный, тип `article_image`.
- [ ] Добавить Rutube-видео (валидная ссылка) → плеер рендерится в редакторе и на сайте.
- [x] Невалидная Rutube-ссылка → понятная ошибка/подсветка; запись не сохраняется. — решили не делать

## 3. Заголовок и slug
- [x] Изменить Заголовок (slug не трогаем) → заголовок обновлён в CRM и на сайте; URL статьи прежний.

## 4. Превью и главное изображение
- [ ] Изменить «Превью» → текст обновлён в карточке/на странице статьи.
- [x] Заменить «Главное изображение» → на списке и в статье отображается новое.
- [x] Попытаться добавить второй файл в «Главное изображение» → доступна только замена существующего / понятная ошибка, больше 1 файла не прикрепляется.

## 5. SEO
- [x] Обновить Title/Keywords/Description → на странице статьи метатеги соответствуют введённым (проверка в DevTools).

## 6. Публикация
- [x] Снять «Публикация на сайте» и сохранить → статья исчезает со списка и по прямому URL недоступна.
- [x] Включить обратно и сохранить → статья снова видна и доступна.

## 7. Миграция/совместимость
- [ ] Открыть мигрированную статью → контент отображается блоками; поле `text` не используется при сохранении (в Network уходит `content_blocks`).
- [ ] Внести правку в блок и сохранить → сайт выводит контент из `content_blocks` (совпадает с редактором).

## 8. Устойчивость/негативы
- [ ] Offline в DevTools при сохранении → показана ошибка; после возврата сети данные в редакторе не потеряны.
- [x] Загрузить неподдерживаемый файл для блока «Изображение» → понятная ошибка; другие изменения не теряются.

## 9. Вывод на сайте (`https://anflat.ru/articles/` и страница статьи)
- [ ] Обновить список и страницу статьи (Ctrl+F5) → заголовок/превью/обложка/порядок блоков совпадают с CRM; изображения по публичным URL; Rutube-плеер работает.

---

## Результат проверки / Комментарии / Файлы
- Итог: Pass/Fail  
- Комментарии: …  
- Файлы: `checklists/crm/assets/...`

## Итоги проверки

**Сессия:** CRM → Сайт — Блог / Редактирование (SMOKE)  
**Дата:** 24.09.2025  
**Сборка/Версия:** v.b704280f  
**URL:** https://crm-test.anflat.ru/management/site-developer-admin/blog-articles/list

### Покрытие
- Загрузка формы «Редактирование» существующей статьи
- Правки в contentBlocks: текст, добавление/удаление блоков, перемещение
- Блоки «Изображение» (article_image), «Rutube-видео»
- Поля SEO; флаг «Публикация на сайте»
- Отображение статьи на сайте (листинг + страница)
- Виджет «Главное изображение» в создании (кнопка «Скачать»)

### Найдено
- **Сохранение не активируется от правок в контенте.** При изменениях только в `contentBlocks` кнопка «Сохранить» остаётся неактивной; активируется после правок в других полях (обложка/SEO).  
  Файл: `checklists/assets/Запись_экрана_2025-09-24_1310341.mp4`
- **Сайт не рендерит контент из `content_blocks`.** После публикации/редактирования на сайте отсутствуют текст/картинки/видео из контента; меняется только главное изображение. Похоже, сайт продолжает читать `text` вместо `content_blocks`.
- **Rutube (невалидная ссылка) сохраняется.** Блок с неверной ссылкой сохраняется; в CRM пометка «видео недоступно», на сайте блока нет — нет валидации/запрета сохранения.
- **Превью не выводится на сайте.** В листинге/на странице виден только заголовок.
- **Ограничение форматов для изображений в контенте.** `.webp` отклоняется (допускаются только jpg/jpeg/png/svg) — требуется решение: поддерживать webp или явно не поддерживать.

### Вывод
- **Status:** Fail  
- Риски/наблюдения: редактор сохраняет контент, но фронт сайта не умеет его рендерить; высокие риски пустых статей на проде после миграции. Отсутствие валидации Rutube ведёт к «битым» блокам в данных.

### План ретеста (после фиксов)
1. Изменения `content_blocks` «грязнят» форму: кнопка **Сохранить** активна; правки сохраняются (проверка в Network и повторном открытии).  
2. Сайт рендерит `content_blocks` (порядок, текст, изображения с публичными URL, Rutube-плеер). `text` используется только как фолбэк при `content_blocks = null`.  
3. Невалидная Rutube-ссылка блокирует сохранение блока с понятной ошибкой (клиент/сервер).  
4. Превью отображается в листинге и/или на странице статьи (как задумано).  
5. Форматы изображений: если принято решение поддерживать `.webp` — файл загружается и рендерится; если нет — сообщение об ошибке явное и единообразное.

### Ретест-лог
| Баг/Задача | Что фиксили | Версия | Результат | Примечания |
| --- | --- | --- | --- | --- |
| [ANFLAT-3752](https://task.kant.one/issue/ANFLAT-3752/Pereformatirovanie-statej-pod-novyj-redaktor) |  | v.b704280f | ☐ / ✅ |  |
