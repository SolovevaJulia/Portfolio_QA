# TC — Контакты → Работа и доходы: валидация верхней границы даты (будущие даты запрещены)

**Project:** CRM  
**Компонент/Модуль:** Контакты → Карточка → Доп. информация → Работа и доходы  
**Экран/URL/Маршрут:** ``  
**Автор/Тестер:** Юлия  
**Дата создания / Обновлён:** 2025-09-17 / 2025-09-17  
**Сборка/Версия:** v.56e46cf9
**Окружение:** test  
**Устройство/ОС/Браузер:** Windows 11 / Chrome 140  
**Тип теста:** функциональный (валидации)  
**Приоритет:** High  
**Тестовые данные:** контакт `{id}` доступен к редактированию; текущая дата = «сегодня».

## Цель
Проверить, что поля **Дата начала работы (общий стаж)** и **Дата начала работы на послед. месте работы** не принимают будущие значения и возвращают понятную ошибку; валидные даты сохраняются и персистят.

## Предусловия
- Пользователь авторизован как «Менеджер» с правом редактирования.
- Открыта карточка существующего контакта.

## Шаги
1. Открыть вкладку **Доп. информация** → блок **Работа и доходы**.  
2. Ввести в оба поля дату «завтра» (будущая дата) и нажать **Сохранить**.  
3. Зафиксировать текст/расположение ошибок, состояние кнопки **Сохранить**.  
4. Заменить значения на «сегодня» и нажать **Сохранить**.  
5. Обновить страницу (F5).  
6. Ввести `31.12.2099` в поле «общий стаж», второе оставить валидным, нажать **Сохранить**.  
7. Ввести `29.02.2023` (не високосный) → ожидать ошибку; затем `29.02.2024` → сохранить.  
8. Проверить Network/консоль на предмет 4xx/ошибок и корректности тела ответа при неуспехе.

## Ожидаемый результат 
1. Страница/блок доступны, поля редактируемы.  
2. Валидация срабатывает: поля подсвечены, показан человеко-читаемый текст об ошибке, сохранение блокируется.  
3. Кнопка **Сохранить** остаётся активной/неактивной согласно политике (обычно активна при изменениях), фокус остаётся в первом невалидном поле.  
4. Сохранение проходит успешно; уведомление «Сохранено»; ошибок в консоли/Network нет.  
5. После перезагрузки значения «сегодня» сохранены (персистентность).  
6. Значение `31.12.2099` отклонено; второе поле остаётся без ошибки; сохранение блокируется; текст ошибки поясняет «дата не может быть в будущем/вне диапазона».  
7. `29.02.2023` отклонено; `29.02.2024` — сохраняется успешно; уведомление «Сохранено».  
8. Для невалидных попыток API отвечает 4xx с полем-указателем; UI не «ломается» (кнопки не пропадают), консоль чистая.

## Фактический результат
- Шаг 2: **Fail** — будущая дата сохраняется, ошибок нет.
- Шаг 4: **Pass** — "сегодня" сохраняется, уведомление "Сохранено".
- Шаг 6: **Fail** — 31.12.2099 сохраняется, ошибок нет.

## Критерии приёма
- Будущие даты в обоих полях запрещены на фронте и на бэке; понятные сообщения об ошибке.  
- Валидные даты сохраняются и отображаются после перезагрузки.  
- Нет JS-ошибок, лишних повторов запросов, некорректных UI-состояний.

## Постусловия / Очистка
- Оставить валидные даты; при необходимости вернуть исходные значения.

## Связанные артефакты
- Баг: `BUG-2025-09-16-contact-work-start-date-future.md`
- Чек-лист: `CL-contacts-work-and-income-SMOKE.md`

## Результат выполнения
**Статус:** **Fail**  
**Исполнитель/Дата:** Юлия / 2025-09-17  
**Комментарии:** Нарушена верхняя граница дат; оформить баг `BUG-2025-09-16-contact-work-start-date-future.md`, добавить acceptance.

