# Тест-кейс — CRM → Контур (CV): JPG → распознавание паспорта и применение данных (позитивный)

**Project:** CRM  
**Компонент/Модуль:** Контур (CV)  
**Экран/URL/Маршрут:** Проверки → «Проверить физ. лицо»  
**Автор/Тестер:** Юлия  
**Дата создания / Обновлён:** 30.10.2025 / 30.10.2025  
**Окружение:** test
**Сборка/Версия:** v.b2cc5f9f
**Роль:** admin
**ОС/Браузер/Разрешение:** Windows 11 / Chrome (последняя) / 1920×1080
**Тип теста:** Позитивный  
**Автоматизация:** Нет  
**Тестовые данные:** `passport_ru_good.jpg` (ровный, читабельный скан 1-й страницы; ~1–3 МБ; image/jpeg)
### Цель
Проверить базовый сценарий: загрузка JPG, корректное распознавание и маппинг полей, подсветка областей на превью, применение данных в форму и отправка метрики.

### Предусловия
- Пользователь авторизован (admin), открыт экран «Проверки».
- Доступен файл `passport_ru_good.jpg`.

### Шаги
1. Нажать **«Проверить физ. лицо»** → открыть модалку распознавания.  
2. Выбрать файл `passport_ru_good.jpg`.  
3. Дождаться окончания распознавания (индикатор/статус).  
4. Визуально проверить автозаполнение полей слева и подсветку областей на превью.  
5. При необходимости поправить регистры (необязательно).  
6. Нажать **«Применить»**.  
7. Проверить, что данные перенесены в форму «Физ. лицо» на экране «Проверки»; в Network провернуть отправку метрики.

### Ожидаемый результат (по шагам)
1. Модалка открыта, элементы активны.  
2. Файл принят, начался процесс; ограничения по размеру соответствуют ТЗ.  
3. Процесс завершается без ошибок ≤ 3–5 с.  
4. Поля заполнены и нормализованы:  
   - Фамилия/Имя/Отчество — Title Case;  
   - Номер (10 цифр из `number`) → **Серия** 4 + **Номер** 6 (маски применены);  
   - **Код подразделения** — формат `NNN-NNN`;  
   - **Дата рождения** и **Дата выдачи** — `ДД.ММ.ГГГГ`;  
   - **Кем выдан**, **Место рождения** — без лишних пробелов/капса.  
   На превью подсветка совпадает с соответствующими полями; фокус по клику синхронен.  
5. Ручные правки сохраняются локально и не перекрываются повторной подсветкой.  
6. **«Применить»** активна и сохраняет данные без ошибок; модалка закрывается.  
7. Форма «Физ. лицо» заполнена значениями из модалки; **метрика `cv.detect.send.dialog`** отправлена **ровно 1 раз** с полями `status=success`, `duration` реалистична, `file_type=image/jpeg`, `file_size` соответствует файлу; консоль без ошибок.

### Фактический результат
- Модалка открывается, файл `passport_ru_good.jpg` принимается, индикатор процесса есть.  
- Распознавание завершается без 5xx/краша; превью и рамки показаны.  
- Заполнились: Фамилия, Имя, Отчество, Дата рождения, Дата выдачи, Кем выдан, Место рождения.  
- Серия/Номер: сплит сработал (4+6), маски применились.  
- **Код подразделения не распознан** (поле осталось пустым).  
- Отдельные поля интерпретированы неточно (смещение значений; см. скрин/пример).  
- Кнопка «Применить» активна; данные применяются в форму «Физ. лицо».  
- Метрика `cv.detect.send.dialog` отправилась 1 раз; `status=success`, `file_type=image/jpeg` (проверено в Network). `duration` и `file_size` присутствуют.

### Критерии приёма
- Распознавание без ошибок; автозаполнение корректно; подсветка соответствует полям.  
- Данные применяются в форму и персистят при переходе.  
- Метрика отправляется один раз с ожидаемыми полями.

### Постусловия / Очистка
- Закрыть модалку; очистить временные данные (если предусмотрено); сбросить форму.

### Логи/Скриншоты/Консоли
- Скрины модалки до/после:  
  `test-cases/crm/assets/Снимок_экрана_2025-10-30_122331.png`  
  `test-cases/crm/assets/Снимок_экрана_2025-10-30_122338.png`  
- Network → запрос метрики (payload):  
  `test-cases/crm/assets/Снимок_экрана_2025-10-30_122424.png`  
  `test-cases/crm/assets/Снимок_экрана_2025-10-30_122431.png`

### Связанные артефакты
- Чек-лист: `checklists/crm/CL-crm-kontur-passport-ocr-modal-SMOKE.md`
- Баги: `BUG-2025-10-30-kontur-ocr-mapping-missing-fields.md`, `BUG-2025-10-30-kontur-ocr-apply-enabled-without-series.md`

### Результат выполнения
**Статус:** **Fail**  
**Исполнитель/Дата:** Юлия / 30.10.2025  
**Комментарии:** Пройдён позитивный сценарий JPG; маппинг частично некорректен, **код подразделения не заполнился**. «Применить» работает. Связано с багами CRM-4312.
